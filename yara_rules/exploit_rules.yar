rule ExploitGeneric
{
    meta:
        description = "Generic exploit detection"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 4
        version = "2.0"
    
    strings:
        $mz = "MZ"
        $shellcode1 = { 90 90 90 90 }  // NOP sled
        $shellcode2 = { 31 C0 50 68 }  // XOR EAX,EAX PUSH EAX PUSH ...
        $shellcode3 = "GetProcAddress" ascii nocase
        $shellcode4 = "LoadLibrary" ascii nocase
        $shellcode5 = "VirtualProtect" ascii nocase
        $shellcode6 = "CreateProcess" ascii nocase
        $heap1 = "HeapCreate" ascii nocase
        $heap2 = "HeapAlloc" ascii nocase
        $stack1 = "VirtualAlloc" ascii nocase
        $stack2 = "VirtualFree" ascii nocase
        $memory1 = "WriteProcessMemory" ascii nocase
        $memory2 = "ReadProcessMemory" ascii nocase
        $thread1 = "CreateRemoteThread" ascii nocase
        $thread2 = "CreateThread" ascii nocase
        $dll1 = "LoadLibrary" ascii nocase
        $dll2 = "GetProcAddress" ascii nocase
        
    condition:
        $mz at 0 and
        3 of ($shellcode*, $heap*, $stack*, $memory*, $thread*, $dll*) and
        filesize < 1000KB
}

rule BufferOverflowExploit
{
    meta:
        description = "Buffer overflow exploit detection"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 5
        version = "2.0"
    
    strings:
        $mz = "MZ"
        $overflow1 = { 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 }  // 16 A's
        $overflow2 = { 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 42 }  // 16 B's
        $overflow3 = { 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 43 }  // 16 C's
        $ret1 = "return" ascii nocase
        $stack1 = "stack" ascii nocase
        $overflow4 = { 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 }  // 16 NOPs
        $overflow5 = { CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC }  // 16 INT3
        $overflow6 = { C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 C3 }  // 16 RET
        $eip1 = "EIP" ascii nocase
        $eip2 = "RIP" ascii nocase
        $jump1 = "JMP" ascii nocase
        $jump2 = "CALL" ascii nocase
        
    condition:
        $mz at 0 and
        2 of ($overflow*, $ret1, $stack1, $eip*, $jump*) and
        filesize < 500KB
}

rule ROPExploit
{
    meta:
        description = "Return-Oriented Programming exploit detection"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 5
        version = "1.0"
    
    strings:
        $mz = "MZ"
        $rop1 = { 58 5A 59 5B }  // POP instructions
        $rop2 = { 5E 5F 5D 5C }  // POP instructions
        $rop3 = { C3 }           // RET
        $rop4 = { C2 ?? ?? }     // RET imm16
        $rop5 = "VirtualProtect" ascii nocase
        $rop6 = "VirtualAlloc" ascii nocase
        $rop7 = "HeapCreate" ascii nocase
        $rop8 = "WriteProcessMemory" ascii nocase
        $gadget1 = "pop " ascii nocase
        $gadget2 = "ret" ascii nocase
        $gadget3 = "call " ascii nocase
        $gadget4 = "jmp " ascii nocase
        
    condition:
        $mz at 0 and
        3 of ($rop*, $gadget*) and
        filesize < 1000KB
}

rule ShellcodeGeneric
{
    meta:
        description = "Generic shellcode detection"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 4
        version = "1.0"
    
    strings:
        $shellcode1 = { 90 90 90 90 }  // NOP sled
        $shellcode2 = { 31 C0 50 68 }  // XOR EAX,EAX PUSH EAX PUSH ...
        $shellcode3 = { 60 BE ?? ?? ?? ?? 8D }  // PUSHAD MOV ESI ...
        $shellcode4 = { B8 ?? ?? ?? ?? 05 }  // MOV EAX ... ADD EAX ...
        $shellcode5 = { 33 C0 50 6A }  // XOR EAX,EAX PUSH EAX PUSH ...
        $shellcode6 = { 6A 30 56 68 }  // PUSH 0x30 PUSH ESI PUSH ...
        $shellcode7 = { EB ?? E8 ?? ?? ?? ?? }  // JMP SHORT ... CALL ...
        $decoder1 = "decoder" ascii nocase
        $decoder2 = "decode" ascii nocase
        $decoder3 = "unpack" ascii nocase
        $api1 = "GetProcAddress" ascii nocase
        $api2 = "LoadLibrary" ascii nocase
        $api3 = "CreateProcess" ascii nocase
        $api4 = "WinExec" ascii nocase
        
    condition:
        3 of ($shellcode*, $decoder*, $api*) and
        filesize < 500KB
}