,rule FilelessMalware
{
    meta:
        description = "Detects fileless malware techniques"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 5
        version = "1.0"
    
    strings:
        $wmic1 = "wmic" ascii nocase
        $wmic2 = "process call create" ascii nocase
        $wmic3 = "path Win32_Process" ascii nocase
        $reg1 = "reg add" ascii nocase
        $reg2 = "HKCU\\" ascii nocase
        $reg3 = "HKLM\\" ascii nocase
        $schtasks1 = "schtasks" ascii nocase
        $schtasks2 = "/create" ascii nocase
        $schtasks3 = "/sc" ascii nocase
        $powershell1 = "powershell" ascii nocase
        $powershell2 = "-nop" ascii nocase
        $powershell3 = "-w hidden" ascii nocase
        $wmi1 = "Get-WmiObject" ascii nocase
        $wmi2 = "Win32_" ascii nocase
        $com1 = "COMSPEC" ascii nocase
        $com2 = "%COMSPEC%" ascii nocase
        
    condition:
        filesize < 2000KB and
        3 of ($wmic*, $reg*, $schtasks*, $powershell*, $wmi*, $com*)
}

rule LivingOffTheLand
{
    meta:
        description = "Detects Living Off The Land techniques"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 4
        version = "1.0"
    
    strings:
        $lolbas1 = "certutil" ascii nocase
        $lolbas2 = "-decode" ascii nocase
        $lolbas3 = "-urlcache" ascii nocase
        $lolbas4 = "bitsadmin" ascii nocase
        $lolbas5 = "/transfer" ascii nocase
        $lolbas6 = "mshta" ascii nocase
        $lolbas7 = "rundll32" ascii nocase
        $lolbas8 = "regsvr32" ascii nocase
        $lolbas9 = "msbuild" ascii nocase
        $lolbas10 = "InstallUtil" ascii nocase
        $lolbas11 = "csc" ascii nocase
        $lolbas12 = "vbc" ascii nocase
        $lolbas13 = "odbcconf" ascii nocase
        $lolbas14 = "pcalua" ascii nocase
        $lolbas15 = "forfiles" ascii nocase
        
    condition:
        filesize < 2000KB and
        2 of ($lolbas*)
}

rule AdvancedRansomware
{
    meta:
        description = "Detects advanced ransomware techniques"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 5
        version = "1.0"
    
    strings:
        $crypto1 = "CryptAcquireContext" ascii nocase
        $crypto2 = "CryptGenKey" ascii nocase
        $crypto3 = "CryptExportKey" ascii nocase
        $crypto4 = "CryptImportKey" ascii nocase
        $crypto5 = "CryptEncrypt" ascii nocase
        $crypto6 = "CryptDecrypt" ascii nocase
        $rsa1 = "RSA" ascii nocase
        $aes1 = "AES" ascii nocase
        $ecc1 = "ECC" ascii nocase
        $ecc2 = "EllipticCurve" ascii nocase
        $key1 = "publickey" ascii nocase
        $key2 = "privatekey" ascii nocase
        $key3 = "keypair" ascii nocase
        $key4 = "GenerateKey" ascii nocase
        $file1 = "FindFirstFile" ascii nocase
        $file2 = "FindNextFile" ascii nocase
        $file3 = "SetFileAttributes" ascii nocase
        $file4 = "DeleteFile" ascii nocase
        $file5 = "MoveFile" ascii nocase
        $enum1 = "EnumSystemLocales" ascii nocase
        $enum2 = "EnumWindows" ascii nocase
        $process1 = "CreateToolhelp32Snapshot" ascii nocase
        $process2 = "Process32First" ascii nocase
        $process3 = "Process32Next" ascii nocase
        
    condition:
        filesize < 10000KB and
        5 of ($crypto*, $rsa*, $aes*, $ecc*, $key*, $file*, $enum*, $process*)
}

rule AdvancedTrojan
{
    meta:
        description = "Detects advanced trojan techniques"
        author = "AegisAI"
        date = "2025-10-20"
        threat_level = 4
        version = "1.0"
    
    strings:
        $network1 = "WSAStartup" ascii nocase
        $network2 = "connect" ascii nocase
        $network3 = "send" ascii nocase
        $network4 = "recv" ascii nocase
        $network5 = "socket" ascii nocase
        $network6 = "bind" ascii nocase
        $network7 = "listen" ascii nocase
        $network8 = "accept" ascii nocase
        $network9 = "htons" ascii nocase
        $network10 = "inet_addr" ascii nocase
        $c21 = "CommandAndControl" ascii nocase
        $c22 = "C2" ascii nocase
        $c23 = "botnet" ascii nocase
        $c24 = "callback" ascii nocase
        $c25 = "beacon" ascii nocase
        $persistence1 = "SetWindowsHookEx" ascii nocase
        $persistence2 = "RegisterServiceCtrlHandler" ascii nocase
        $persistence3 = "CreateService" ascii nocase
        $persistence4 = "StartService" ascii nocase
        $persistence5 = "RegSetValue" ascii nocase
        $persistence6 = "SchTasks" ascii nocase
        $injection1 = "CreateRemoteThread" ascii nocase
        $injection2 = "WriteProcessMemory" ascii nocase
        $injection3 = "VirtualAllocEx" ascii nocase
        $injection4 = "SetThreadContext" ascii nocase
        $injection5 = "NtUnmapViewOfSection" ascii nocase
        $evasion1 = "IsDebuggerPresent" ascii nocase
        $evasion2 = "CheckRemoteDebuggerPresent" ascii nocase
        $evasion3 = "GetTickCount" ascii nocase
        $evasion4 = "OutputDebugString" ascii nocase
        $evasion5 = "NtDelayExecution" ascii nocase
        $evasion6 = "Sleep" ascii nocase
        
    condition:
        filesize < 5000KB and
        6 of ($network*, $c2*, $persistence*, $injection*, $evasion*)
}

rule Suspicious_Encryption_Code {
    meta:
        description = "Detects suspicious encryption code patterns"
        severity = "high"
    strings:
        $encrypt1 = "encrypt" nocase
        $encrypt2 = "cipher" nocase
        $encrypt3 = "crypt" nocase
    condition:
        any of them
}

rule Suspicious_File_Operations {
    meta:
        description = "Detects suspicious file operations"
        severity = "medium"
    strings:
        $write1 = "WriteFile" nocase
        $create1 = "CreateFile" nocase
    condition:
        any of them
}

rule Registry_Manipulation {
    meta:
        description = "Detects registry manipulation attempts"
        severity = "high"
    strings:
        $reg1 = "RegSetValue" nocase
        $reg2 = "RegCreateKey" nocase
    condition:
        any of them
}

rule Process_Creation {
    meta:
        description = "Detects process creation attempts"
        severity = "medium"
    strings:
        $proc1 = "CreateProcess" nocase
        $proc2 = "WinExec" nocase
    condition:
        any of them
}

rule Keylogger_Signatures {
    meta:
        description = "Detects keylogger signatures"
        severity = "high"
    strings:
        $key1 = "GetAsyncKeyState" nocase
        $key2 = "GetKeyboardState" nocase
    condition:
        any of them
}

rule Memory_Manipulation {
    meta:
        description = "Detects memory manipulation attempts"
        severity = "high"
    strings:
        $mem1 = "WriteProcessMemory" nocase
        $mem2 = "VirtualAlloc" nocase
        $mem3 = "CreateRemoteThread" nocase
    condition:
        any of them
}
